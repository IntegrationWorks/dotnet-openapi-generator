apiVersion: "scaffolder.backstage.io/v1beta3"
kind: "Template"
metadata:
  name: "dotnet-openapi-model-generator"
  title: "DotNet OpenAPI Model Generator"
  description: "Generates C# models for a given OpenAPI spec."
  tags:
    - "recommended"
    - "dotnet"
  annotations:
    github.com/project-slug: "IntegrationWorks/dotnet-openapi-generator"
spec:
  owner: "user:guest"
  type: "service"
  parameters:
  - title: "Repository info"
    requried:
      - "apiSpecRepo"
      - "apiSpecPath"
      - "targetRepo"
      - "targetModelsPath"
      - "targetCsNamespace"
    properties:
      apiSpecRepo:
        title: "API Spec Repo"
        type: "string"
        description: "The repo which holds the API spec. eg (IntegrationWorks/OpenAPI-schema-specs)"
      apiSpecPath:
        title: "API Spec Path"
        type: "string"
        description: "The path to the API spec in the API spec repo. eg (yaml-schema/petstore.yaml)"
      targetRepo:
        title: "Target Git Repository"
        type: "string"
        description: "The repository of the repo which holds the DotNet application. eg (IntegrationWorks/DotNetDemo)"
      targetModelsPath:
        title: "Target Models Path"
        type: "string"
        description: "The path which the generated code will be written to. eg (src/MyProject/Generated/Models)"
      targetCsNamespace:
        title: "Generated C# Namespace"
        type: "string"
        description: "The name of the namespace which will be used by the generator. eg (MyProject.Generated.Models)"
        ui:field: "EntityNamePicker"
  steps:
    - action: "github:actions:dispatch"
      name: "Run Generate Code GitHub Action"
      input:
        repoUrl: "github.com?repo=dotnet-openapi-generator&owner=IntegrationWorks"
        workflowId: "openapi-generate.yaml"
        branchOrTagName: "main"
        token: ${{ secrets.USER_OAUTH_TOKEN }}
        workflowInputs:
          api_spec_repo: "${{ parameters.apiSpecRepo }}"
          api_spec_path: "${{ parameters.apiSpecPath }}"
          target_repo: "${{ parameters.targetRepo }}"
          target_path: "${{ parameters.targetModelsPath }}"
          namespace_name: "${{ parameters.targetCsNamespace }}"